<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EPA 關卡 1｜學員中心思維分類</title>
<style>
  :root{
    --bg:#FFF7F3; /* 柔和米杏 */
    --card:#FFFFFF;
    --shadow:0 6px 18px rgba(0,0,0,.08);
    --t:#222;
    --muted:#667085;
    --brand:#6C79FF; /* 馬卡龍藍紫 */
    --good:#55C595; /* 馬卡龍綠 */
    --warn:#FFB84D; /* 馬卡龍橘 */
    --bad:#FF7A88;  /* 馬卡龍粉紅 */
    --yellow:#FFF2C6;
    --green:#E8FFF1;
    --pink:#FFE8ED;
    --blue:#E9EDFF;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:"Inter Var", ui-sans-serif, system-ui, -apple-system, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Arial;
    background: radial-gradient(1200px 800px at 80% -10%, #FFE9F3 0%, rgba(255,233,243,0) 60%), var(--bg);
    color:var(--t);
  }
  .wrap{max-width:1100px; margin:0 auto; padding:16px 16px 24px}
  header{display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:12px}
  .title{
    display:flex; align-items:center; gap:12px;
    padding:10px 14px; background:#fff; border-radius:16px; box-shadow:var(--shadow);
  }
  .title h1{font-size:18px; margin:0}
  .badge{font-size:12px; color:#4B5563; background:linear-gradient(180deg,#fff, #F6F9FF); border:1px solid #E8EBFF; padding:6px 10px; border-radius:999px}
  .toolbar{display:flex; gap:8px; flex-wrap:wrap}
  button{border:0; border-radius:12px; padding:10px 14px; font-weight:600; cursor:pointer; box-shadow:var(--shadow); transition:transform .05s ease}
  button:active{transform:translateY(1px)}
  .primary{background:linear-gradient(180deg,#7A86FF, #6C79FF); color:#fff}
  .ghost{background:#fff}
  .success{background:linear-gradient(180deg,#75D7A8,#55C595); color:#fff}
  .danger{background:linear-gradient(180deg,#FFA0AD,#FF7A88); color:#fff}

  .hint{margin:10px 0 16px; color:var(--muted); font-size:14px}

  .grid{display:grid; grid-template-columns:1fr; gap:12px}
  @media(min-width:860px){.grid{grid-template-columns: 1.1fr 1fr 1fr 1fr}}

  .pool, .bucket{min-height:160px; background:#fff; border-radius:16px; box-shadow:var(--shadow); padding:12px}
  .pool{background:linear-gradient(180deg,#ffffff,#FDFBFF)}

  .bucket{position:relative}
  .bucket[data-category="teacher"]{background:linear-gradient(180deg,#ffffff, var(--pink))}
  .bucket[data-category="learner"]{background:linear-gradient(180deg,#ffffff, var(--green))}
  .bucket[data-category="over"]{background:linear-gradient(180deg,#ffffff, var(--yellow))}

  .bucket h3{margin:0 0 8px; font-size:15px; display:flex; align-items:center; gap:8px}
  .bucket h3 span{font-size:20px}

  .cards{display:flex; flex-wrap:wrap; gap:8px}
  .card{
    user-select:none; -webkit-user-drag:none; touch-action:none;
    background:var(--card); border-radius:14px; padding:12px 12px; min-width:180px; max-width:260px; flex:1 0 180px;
    box-shadow:var(--shadow); cursor:grab; border:1px solid rgba(0,0,0,.04);
    transition:transform .15s ease, box-shadow .15s ease;
  }
  .card:active{cursor:grabbing}
  .card.small{min-width:140px}
  .card .tag{font-size:12px; color:#9CA3AF}
  .card.dragging{opacity:.9; transform:rotate(2deg) scale(1.03)}
  .card.follow{position:fixed; z-index:9999; pointer-events:none; transform:translate(-50%,-50%) scale(1.03);} 

  .drop-highlight{outline:2px dashed rgba(0,0,0,.15); outline-offset:-6px}
  .bucket.hover{outline:3px solid rgba(108,121,255,.35); outline-offset:-6px}

  .footer{
    margin-top:14px; display:flex; flex-wrap:wrap; gap:8px; align-items:center
  }
  .score{font-weight:700}
  .pill{background:#fff; border-radius:999px; padding:6px 10px; box-shadow:var(--shadow); font-size:12px}

  /* Modal for tap-to-place on mobile */
  .modal{position:fixed; inset:0; background:rgba(0,0,0,.15); display:none; align-items:flex-end}
  .sheet{background:#fff; border-radius:18px 18px 0 0; padding:12px; box-shadow:0 -10px 30px rgba(0,0,0,.15); width:100%}
  .sheet h4{margin:4px 6px 10px}
  .choices{display:flex; gap:10px}
  .choice{flex:1; padding:12px; border-radius:14px; border:1px solid rgba(0,0,0,.08); display:flex; gap:8px; align-items:center; justify-content:center}
  .choice[data-target="teacher"]{background:var(--pink)}
  .choice[data-target="learner"]{background:var(--green)}
  .choice[data-target="over"]{background:var(--yellow)}

  .toast{position:fixed; left:50%; transform:translateX(-50%); bottom:18px; background:#111; color:#fff; padding:10px 14px; border-radius:999px; font-size:14px; display:none}

  /* Result panel */
  .result{display:none; margin-top:16px; background:#fff; border-radius:16px; box-shadow:var(--shadow); padding:14px}
  .result h3{margin:0 0 8px}
  .badlist{display:grid; grid-template-columns: 1fr; gap:8px}
  @media(min-width:760px){.badlist{grid-template-columns: 1fr 1fr}}
  .baditem{background:linear-gradient(180deg,#fff,#FFF9FB); border:1px solid #FFE1E6; border-radius:14px; padding:10px}
  .baditem .rewrite{margin-top:6px; background:#F0FFF7; border:1px dashed #BEE8D2; padding:8px; border-radius:10px; font-size:14px}

  /* Cute confetti */
  .confetti{position:fixed; inset:0; pointer-events:none}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">
      <span style="font-size:20px">🎯</span>
      <h1>EPA 關卡 1｜把「教學決策語句」分類</h1>
      <span class="badge">Mobile-first · 拖拉 or 點選放置</span>
    </div>
    <div class="toolbar">
      <button class="ghost" id="btnShuffle">洗牌</button>
      <button class="ghost" id="btnReset">重置</button>
      <button class="ghost" id="btnHint">提示 × <span id="hintLeft">2</span></button>
      <button class="primary" id="btnCheck">送出判定</button>
    </div>
  </header>

  <p class="hint">請把下方句子拖放到正確的類別。提示：<b>學員中心 ≠ 無條件包容</b>，而是依能力分級的「責任委託」。</p>

  <div class="grid">
    <section class="pool" id="pool">
      <h3 style="margin:0 0 8px; display:flex; align-items:center; gap:8px">🃏 待分類卡片</h3>
      <div class="cards" id="poolCards"></div>
    </section>

    <section class="bucket" data-category="teacher">
      <h3><span>👩‍🏫</span> 教師中心</h3>
      <div class="cards"></div>
    </section>

    <section class="bucket" data-category="learner">
      <h3><span>🌱</span> 學員中心（責任分級）</h3>
      <div class="cards"></div>
    </section>

    <section class="bucket" data-category="over">
      <h3><span>💗</span> 過度包容（不健康）</h3>
      <div class="cards"></div>
    </section>
  </div>

  <div class="footer">
    <span class="pill">長按拖動，或輕點卡片以選擇類別</span>
    <span class="pill">及格門檻：80 分</span>
    <span class="pill" id="progress">0 / 0 已分類</span>
  </div>

  <section class="result" id="result">
    <h3>解析</h3>
    <p style="margin:0 0 10px">你的分數：<b id="score">0</b> 分。下面是需要調整的句子與「學員中心轉譯」。</p>
    <div class="badlist" id="badlist"></div>
  </section>
</div>

<div class="modal" id="modal">
  <div class="sheet">
    <h4>把這句話放到哪一類？</h4>
    <div class="choices">
      <div class="choice" data-target="teacher">👩‍🏫 教師中心</div>
      <div class="choice" data-target="learner">🌱 學員中心</div>
      <div class="choice" data-target="over">💗 過度包容</div>
    </div>
    <div style="margin-top:10px; font-size:13px; color:#6b7280">沒有把握？點選上方「提示」可獲得 50/50 線索或說明。</div>
  </div>
</div>
<div class="toast" id="toast">已放置</div>
<canvas class="confetti" id="confetti"></canvas>

<script>
  // ==== 題庫（12～15 句）====
  const BANK = [
    {text:"這個工作我自己做比較快，學員看我就好。", type:"teacher", rewrite:"讓學員先做一次，我在旁邊安全監督並即時回饋。", reason:"把效率放在教師身上；未提供學員可委託的片段與回饋循環。"},
    {text:"我覺得他差不多了，可以放手讓他做。", type:"teacher", rewrite:"他已符合 3a 的標準情境，我會在可預期情境下半監督放手。", reason:"以教師主觀感覺為依據，未對應具體等級與情境。"},
    {text:"等我有空再帶他練。", type:"teacher", rewrite:"安排短時段微演練，確保每天都有練習與回饋循環。", reason:"以教師時間為中心，缺乏規律化的學員練習安排。"},
    {text:"今天交班很趕，就不要讓學員講了。", type:"teacher", rewrite:"讓學員先做精要版，我補關鍵並控制風險。", reason:"用時間壓力取代學習機會；未設計低風險的可委託片段。"},

    {text:"他已能依步驟完成，但信心不足，給一次獨立完成的機會。", type:"learner", rewrite:"——", reason:"根據表現調整監督強度，提供可掌握挑戰以強化自我效能。"},
    {text:"此任務難度適中，正好挑戰他的下一階能力。", type:"learner", rewrite:"——", reason:"以學員當前能力做配適，創造可達成的伸展目標。"},
    {text:"我先觀察他做一次，結束後給 2 條具體可改進建議。", type:"learner", rewrite:"——", reason:"強調可觀察行為與具體回饋，支援成長循環。"},
    {text:"讓學員先交班，我負責把關安全與時間。", type:"learner", rewrite:"——", reason:"設定邊界並分擔風險，屬責任分級下的委託。"},

    {text:"他沒準備也沒關係，下次再說。", type:"over", rewrite:"先界定最小安全任務，給明確預期與下次前要達到的準備。", reason:"模糊標準、放任延宕，無助於學習與安全。"},
    {text:"別跟他說錯在哪，免得打擊信心。", type:"over", rewrite:"回饋聚焦在行為與結果，避免貼標籤，同時給下一步具體作法。", reason:"以保護為名迴避回饋，削弱學習成效。"},
    {text:"我來處理就好，不用麻煩他。", type:"over", rewrite:"切出可委託片段，讓他在我監督下負責一小段。", reason:"剝奪練習機會且無成長責任。"},

    {text:"他抽血技巧還不熟，先用 DOPS 集中練習 3 次。", type:"learner", rewrite:"——", reason:"分離單一技能以 DOPS 針對練，用於支撐 EPA 任務表現。"},
    {text:"交班內容常遺漏重點，讓他用 ISBAR 結構練習並錄音回顧。", type:"learner", rewrite:"——", reason:"導入結構化工具與自我回顧，提升任務品質。"},
    {text:"昨天他出現兩次高風險錯誤，今天改回全程監督。", type:"learner", rewrite:"——", reason:"依風險動態調整監督強度，確保安全為先。"}
  ];

  // ==== 狀態 ====
  const $pool = document.getElementById('poolCards');
  const $buckets = [...document.querySelectorAll('.bucket')];
  const $progress = document.getElementById('progress');
  const $result = document.getElementById('result');
  const $badlist = document.getElementById('badlist');
  const $score = document.getElementById('score');
  const $toast = document.getElementById('toast');
  const $modal = document.getElementById('modal');
  let activeCard = null;
  let hintLeft = 2; const $hintLeft = document.getElementById('hintLeft');
  // 觸控拖曳狀態
  let pointerDragging=false; let dragOffsetX=0, dragOffsetY=0; let originParent=null; let currentHoverBucket=null;

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}
    return arr
  }

  function makeCard(item, idx){
    const el=document.createElement('div');
    el.className='card';
    el.textContent=item.text;
    el.dataset.key=idx;
    el.draggable=true;
    // Mouse drag (桌機)
    el.addEventListener('dragstart', e=>{el.classList.add('dragging'); e.dataTransfer.setData('text/plain', idx);});
    el.addEventListener('dragend', ()=>el.classList.remove('dragging'));
    // Tap-to-place (手機備援)
    el.addEventListener('click', ()=>{ if(pointerDragging) return; activeCard=el; $modal.style.display='flex'});
    // Pointer touch-drag (手機主要)
    el.addEventListener('pointerdown', (e)=>{
      if(e.pointerType!=='touch') return; // 僅在觸控啟用自製拖曳
      e.preventDefault();
      activeCard=el; pointerDragging=true; originParent=el.parentElement;
      const rect=el.getBoundingClientRect();
      dragOffsetX=e.clientX - rect.left - rect.width/2;
      dragOffsetY=e.clientY - rect.top - rect.height/2;
      el.classList.add('follow');
      el.style.width=rect.width+'px';
      moveFollow(el, e.clientX - dragOffsetX, e.clientY - dragOffsetY);
      window.addEventListener('pointermove', onPointerMove, {passive:false});
      window.addEventListener('pointerup', onPointerUp, {once:true});
    });
    return el
  }

  function renderPool(){
    $pool.innerHTML='';
    shuffle(BANK).forEach((item,i)=> $pool.appendChild(makeCard(item, i)) );
    updateProgress();
  }

  function updateProgress(){
    const total=BANK.length;
    const placed= total - $pool.querySelectorAll('.card').length;
    $progress.textContent=`${placed} / ${total} 已分類`;
  }

  // Buckets: dragover/drop（桌機）
  $buckets.forEach(b=>{
    const box=b.querySelector('.cards');
    b.addEventListener('dragover', e=>{e.preventDefault(); box.classList.add('drop-highlight')});
    b.addEventListener('dragleave', ()=> box.classList.remove('drop-highlight'));
    b.addEventListener('drop', e=>{
      e.preventDefault();
      const key=e.dataTransfer.getData('text/plain');
      const card=[...document.querySelectorAll('.card')].find(c=>c.dataset.key===key);
      if(card){ box.appendChild(card); showToast('已放置'); }
      box.classList.remove('drop-highlight');
      updateProgress();
    });
  })

  // Modal choose（手機備援）
  $modal.addEventListener('click', (e)=>{
    if(e.target.classList.contains('choice')){
      const target=e.target.dataset.target;
      const bucket=document.querySelector(`.bucket[data-category="${target}"] .cards`);
      if(activeCard && bucket){ bucket.appendChild(activeCard); showToast('已放置'); }
      $modal.style.display='none'; activeCard=null; updateProgress();
    } else if(e.target.classList.contains('modal')){
      $modal.style.display='none'; activeCard=null;
    }
  });

  // Buttons
  document.getElementById('btnReset').addEventListener('click', ()=>{renderPool(); $buckets.forEach(b=>b.querySelector('.cards').innerHTML=''); $result.style.display='none';});
  document.getElementById('btnShuffle').addEventListener('click', ()=>{renderPool()});
  document.getElementById('btnCheck').addEventListener('click', checkAnswers);
  document.getElementById('btnHint').addEventListener('click', useHint);

  function checkAnswers(){
    // Compute score
    let correct=0; let wrong=[]; const total=BANK.length; const weight=Math.floor(100/total);
    // scan each card and compare bucket
    document.querySelectorAll('.card').forEach(card=>{
      const key=Number(card.dataset.key); const answer=BANK[key].type;
      const parentBucket = card.closest('.bucket');
      const user = parentBucket ? parentBucket.dataset.category : 'pool';
      if(user===answer){ correct++; sparkle(card) } else { if(user!=='pool') wrong.push({text:BANK[key].text, rewrite:BANK[key].rewrite, should:answer, reason:BANK[key].reason}) }
    })
    const score = Math.round( (correct/total) * 100 );
    $score.textContent=score;
    // render wrong list
    $badlist.innerHTML='';
    wrong.forEach(w=>{
      const div=document.createElement('div'); div.className='baditem';
      const shouldLabel = w.should==='teacher'?'教師中心': w.should==='learner'?'學員中心（責任分級）':'過度包容';
      div.innerHTML=`<div><b>應該分類：</b>${shouldLabel}</div><div style="margin-top:6px">${w.text}</div>`;
      if(w.rewrite && w.rewrite!=='——'){
        const rw=document.createElement('div'); rw.className='rewrite'; rw.innerHTML=`<b>學員中心轉譯：</b>${w.rewrite}<br><span style="color:#6b7280">為什麼？${w.reason}</span>`; div.appendChild(rw);
      } else {
        const rw=document.createElement('div'); rw.className='rewrite'; rw.innerHTML=`<b>為什麼？</b>${w.reason}`; div.appendChild(rw);
      }
      $badlist.appendChild(div);
    })
    $result.style.display='block';
    if(score>=80) celebrate();
  }

  function useHint(){
    if(hintLeft<=0){ showToast('提示已用完'); return; }
    if(!activeCard){ showToast('請先點選一張卡片'); return; }
    const key=Number(activeCard.dataset.key); const answer=BANK[key].type; const categories=['teacher','learner','over'];
    // 50/50: 留下正確 + 一個隨機錯誤
    const wrongs = categories.filter(c=>c!==answer); const keep = wrongs[Math.floor(Math.random()*wrongs.length)];
    const options = [answer, keep].map(c=> c==='teacher'?'👩‍🏫 教師中心': c==='learner'?'🌱 學員中心（責任分級）':'💗 過度包容');
    showToast('可能是：'+options.join(' 或 '));
    // 顯示簡短說明
    const tip = BANK[key].reason;
    setTimeout(()=>{ showToast('線索：'+tip) }, 900);
    hintLeft--; $hintLeft.textContent=hintLeft;
  }

  function showToast(msg){$toast.textContent=msg; $toast.style.display='block'; setTimeout(()=>{$toast.style.display='none'},700)}

  // 觸控拖曳：定位與放置
  function getBucketAt(x,y){
    const els = document.elementsFromPoint(x,y);
    return els.find(e=> e.classList && e.classList.contains('bucket')) || null;
  }
  function clearHover(){ if(currentHoverBucket){ currentHoverBucket.classList.remove('hover'); currentHoverBucket=null; } }
  function moveFollow(el, x, y){ el.style.left=x+'px'; el.style.top=y+'px'; el.style.transform='translate(-50%, -50%) scale(1.03)'; }
  function onPointerMove(e){ if(!pointerDragging||!activeCard) return; e.preventDefault();
    moveFollow(activeCard, e.clientX - dragOffsetX, e.clientY - dragOffsetY);
    const b = getBucketAt(e.clientX, e.clientY); if(b!==currentHoverBucket){ clearHover(); if(b){ b.classList.add('hover'); currentHoverBucket=b; } }
  }
  function onPointerUp(e){
    window.removeEventListener('pointermove', onPointerMove);
    if(!activeCard) return;
    if(currentHoverBucket){ currentHoverBucket.classList.remove('hover'); currentHoverBucket.querySelector('.cards').appendChild(activeCard); showToast('已放置'); }
    else { originParent && originParent.appendChild(activeCard); }
    activeCard.classList.remove('follow'); activeCard.style.left=''; activeCard.style.top=''; activeCard.style.width=''; activeCard.style.transform='';
    activeCard=null; pointerDragging=false; clearHover(); updateProgress();
  }

  // Confetti celebration
  const canvas=document.getElementById('confetti'); const ctx=canvas.getContext('2d'); let pieces=[]; function resize(){canvas.width=innerWidth; canvas.height=innerHeight} window.addEventListener('resize', resize); resize();
  function celebrate(){
    pieces=[...Array(120)].map(()=>({x:Math.random()*canvas.width, y:-20, r:6+Math.random()*8, vy:2+Math.random()*3, vx:(Math.random()-.5)*2, a:Math.random()*360, col: ['#FFB3C1','#BDE5D2','#FDE49C','#C9C8FF'][Math.floor(Math.random()*4)]}));
    let t=0; const tick=()=>{ctx.clearRect(0,0,canvas.width,canvas.height); pieces.forEach(p=>{p.y+=p.vy; p.x+=p.vx; p.a+=5; drawConfetti(p)}); t++; if(t<160) requestAnimationFrame(tick); else ctx.clearRect(0,0,canvas.width,canvas.height)}; tick();
  }
  function drawConfetti(p){ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a*Math.PI/180); ctx.fillStyle=p.col; ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r); ctx.restore()}

  // init
  renderPool();
</script>
</body>
</html>
