<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>為什麼要有 EPA？｜快思慢想 ✦（超相容版）</title>
<style>
  :root{
    --bg:#FAF7FF;
    --card:#FFFFFF;
    --shadow:0 6px 18px rgba(0,0,0,.08);
    --t:#2b2b2b;
    --muted:#667085;
    --green:#B7F0D1;
    --pink:#FFD6DE;
    --yellow:#FFE9A9;
    --ring:#9BA6FF;
    --blue:#D7E4FF;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; 
    font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Arial;
    background:
      radial-gradient(900px 600px at 110% -10%, #FFE9F3 0%, rgba(255,233,243,0) 60%),
      radial-gradient(900px 600px at -10% -10%, #E9EDFF 0%, rgba(233,237,255,0) 60%),
      var(--bg);
    color:var(--t);
  }
  .wrap{max-width:980px; margin:0 auto; padding:16px 16px 28px}
  header{display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:12px; flex-wrap:wrap}
  .title{ display:flex; align-items:center; gap:12px; padding:10px 14px; background:#fff; border-radius:16px; box-shadow:var(--shadow); }
  .title h1{font-size:20px; margin:0; font-weight:700}
  .badge{font-size:12px; color:#4B5563; background:linear-gradient(180deg,#fff, #F6F9FF); border:1px solid #E8EBFF; padding:6px 10px; border-radius:999px}
  .toolbar{display:flex; gap:8px; flex-wrap:wrap; z-index:2; position:relative}
  button{border:0; border-radius:14px; padding:10px 14px; font-weight:700; cursor:pointer; box-shadow:var(--shadow); transition:transform .05s ease}
  button:active{transform:translateY(1px)}
  .primary{background:linear-gradient(180deg,#7A86FF, #6C79FF); color:#fff}
  .ghost{background:#fff}
  .hintbtn{background:linear-gradient(180deg,#FFE8AA,#FFD769)}
  .leveltab{background:#fff}
  .leveltab.active{background:#EEF0FF; border:1px solid #C9CDFF}

  .hint{margin:10px 0 16px; color:var(--muted); font-size:14px}

  .grid{display:grid; grid-template-columns:1fr; gap:12px}
  @media(min-width:860px){.grid{grid-template-columns:1fr 1fr 1fr}}
  .pool, .bucket{min-height:160px; background:#fff; border-radius:18px; box-shadow:var(--shadow); padding:12px}
  .pool{grid-column: 1 / -1; background:linear-gradient(180deg,#ffffff,#FDFBFF)}
  .bucket[data-category="teacher"]{background:linear-gradient(180deg,#ffffff, var(--pink))}
  .bucket[data-category="learner"]{background:linear-gradient(180deg,#ffffff, var(--green))}
  .bucket[data-category="over"]{background:linear-gradient(180deg,#ffffff, var(--yellow))}
  .bucket h3{margin:0 0 8px; font-size:15px; display:flex; align-items:center; gap:8px}
  .bucket h3 span{font-size:20px}
  .cards{display:flex; flex-wrap:wrap; gap:8px}

  .card{
    user-select:none; 
    background:var(--card); border-radius:18px; padding:12px 12px; min-width:180px; max-width:260px; flex:1 0 180px;
    box-shadow:var(--shadow); cursor:pointer; border:1px solid rgba(0,0,0,.04);
    transition:transform .15s ease, box-shadow .15s ease; 
  }
  .card:active{transform:scale(0.98)}

  .footer{ margin-top:14px; display:flex; flex-wrap:wrap; gap:8px; align-items:center }
  .pill{background:#fff; border-radius:999px; padding:6px 10px; box-shadow:var(--shadow); font-size:12px}

  .result{display:none; margin-top:16px; background:#fff; border-radius:18px; box-shadow:var(--shadow); padding:14px}
  .result h3{margin:0 0 8px}
  .badlist{display:grid; grid-template-columns: 1fr; gap:8px}
  @media(min-width:760px){.badlist{grid-template-columns: 1fr 1fr}}
  .baditem{background:linear-gradient(180deg,#fff,#FFF9FB); border:1px solid #FFE1E6; border-radius:16px; padding:10px}
  .baditem .rewrite{margin-top:6px; background:#F0FFF7; border:1px dashed #BEE8D2; padding:8px; border-radius:10px; font-size:14px}

  .summary{display:none; background:#fff; border-radius:18px; box-shadow:var(--shadow); padding:14px}
  .summary h3{margin:0 0 8px}
  table{width:100%; border-collapse:separate; border-spacing:0 6px}
  th, td{padding:8px 10px; font-size:14px; vertical-align:top}
  th{color:#555; text-align:left}
  tr{background:#fff; box-shadow:var(--shadow)}
  tr td:first-child{border-radius:12px 0 0 12px}
  tr td:last-child{border-radius:0 12px 12px 0}
  .tag{font-size:12px; padding:2px 8px; border-radius:999px; display:inline-block}
  .t-teacher{background:var(--pink)}
  .t-learner{background:var(--green)}
  .t-over{background:var(--yellow)}

  /* Modal */
  .modal{position:fixed; inset:0; background:rgba(0,0,0,.15); display:none; align-items:flex-end; z-index:5}
  .sheet{background:#fff; border-radius:18px 18px 0 0; padding:12px; box-shadow:0 -10px 30px rgba(0,0,0,.15); width:100%}
  .sheet h4{margin:4px 6px 10px}
  .choices{display:flex; gap:10px}
  .choice{flex:1; padding:12px; border-radius:14px; border:1px solid rgba(0,0,0,.08); display:flex; gap:8px; align-items:center; justify-content:center; cursor:pointer}
  .choice[data-target="teacher"]{background:var(--pink)}
  .choice[data-target="learner"]{background:var(--green)}
  .choice[data-target="over"]{background:var(--yellow)}

  .toast{position:fixed; left:50%; transform:translateX(-50%); bottom:18px; background:#111; color:#fff; padding:10px 14px; border-radius:999px; font-size:14px; display:none; z-index:6}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">
      <span style="font-size:22px">✨</span>
      <h1>為什麼要有 EPA？｜快思慢想 ✦</h1>
      <span class="badge">超相容：點卡片選分類 · 兩階段 + 總表</span>
    </div>
    <div class="toolbar">
      <button class="leveltab active" data-level="1">關卡1｜生活暖身</button>
      <button class="leveltab" data-level="2">關卡2｜臨床教育</button>
      <button class="leveltab" data-level="S">看看怎麼回事</button>
    </div>
    <div class="toolbar">
      <button class="ghost" id="btnShuffle">洗牌</button>
      <button class="ghost" id="btnReset">重置</button>
      <button class="hintbtn" id="btnHint">提示 × <span id="hintLeft">2</span></button>
      <button class="primary" id="btnCheck">送出判定</button>
    </div>
  </header>

  <p class="hint" id="levelIntro">關卡1：用生活小劇場（女友訓練男友😆）理解「教師中心／學員中心／過度包容」。</p>

  <div id="gameArea">
    <div class="grid">
      <section class="pool" id="pool">
        <h3 style="margin:0 0 8px; display:flex; align-items:center; gap:8px">🃏 待分類卡片</h3>
        <div class="cards" id="poolCards"></div>
      </section>

      <section class="bucket" data-category="teacher">
        <h3><span>👩‍🏫</span> 教師中心</h3>
        <div class="cards"></div>
      </section>

      <section class="bucket" data-category="learner">
        <h3><span>🌱</span> 學員中心（責任分級）</h3>
        <div class="cards"></div>
      </section>

      <section class="bucket" data-category="over">
        <h3><span>💗</span> 過度包容（不健康）</h3>
        <div class="cards"></div>
      </section>
    </div>

    <div class="footer">
      <span class="pill">操作：<b>點卡片</b> → 選分類</span>
      <span class="pill">結果顯示：「對幾題／錯幾題」</span>
      <span class="pill" id="progress">0 / 0 已分類</span>
    </div>

    <section class="result" id="result">
      <h3>解析</h3>
      <p style="margin:0 0 10px">本關結果：<b id="rightCount">0</b> 題對、<b id="wrongCount">0</b> 題錯（門檻：<span id="gateText"></span>）。</p>
      <div class="badlist" id="badlist"></div>
    </section>
  </div>

  <section class="summary" id="summaryArea">
    <h3>看看怎麼回事｜關卡 1 + 2 總表</h3>
    <p class="hint">彙整所有題目、分類與「學員中心轉譯／理由」，方便快速對照與自學。</p>
    <div id="summaryTables"></div>
  </section>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="sheet">
    <h4>把這句話放到哪一類？</h4>
    <div class="choices">
      <div class="choice" data-target="teacher">👩‍🏫 教師中心</div>
      <div class="choice" data-target="learner">🌱 學員中心</div>
      <div class="choice" data-target="over">💗 過度包容</div>
    </div>
    <div style="margin-top:10px; font-size:13px; color:#6b7280">沒有把握？點上方「提示」可獲得 50/50 線索或理由。</div>
  </div>
</div>
<div class="toast" id="toast">已放置</div>

<script>
(function(){
  // ---- 題庫 ----
  const BANKS = {
    1: {gate:{needRight:7}, hints:2, intro:"關卡1：生活小劇場（女友訓練男友😆），先搞懂三類思維。", items:[
      {text:"我自己洗比較快，你下次再學就好。", type:"teacher", rewrite:"你先洗一件，我在旁邊看，結束給兩點回饋。", reason:"把效率擺第一，沒有切出可委託片段與回饋循環。"},
      {text:"報告我幫你寫好，下次再教你怎麼寫。", type:"teacher", rewrite:"先讓你寫一版精要版，我一起補強關鍵。", reason:"包辦任務，剝奪練習機會。"},
      {text:"我已經很忙了，等我有空再教你做飯。", type:"teacher", rewrite:"安排10分鐘迷你練習，今天先學打蛋與開火安全。", reason:"以教師時間為中心，缺乏規律化練習。"},
      {text:"今天你負責倒垃圾，我提醒路線與時間點。", type:"learner", rewrite:"——", reason:"設定邊界與監督，屬責任分級的委託。"},
      {text:"你先煎一顆蛋，我看一次，等下給2點建議。", type:"learner", rewrite:"——", reason:"可觀察＋具體回饋，逐步放權。"},
      {text:"你先講今晚的約會流程，我再補充關鍵。", type:"learner", rewrite:"——", reason:"先讓學員輸出，教師把關缺口。"},
      {text:"你今天很累不要做家事了，我全包。", type:"over", rewrite:"把任務切小：你收碗，我刷鍋；維持最小責任。", reason:"過度保護，模糊責任界線。"},
      {text:"怕你受挫，就不說剛剛哪裡做不好。", type:"over", rewrite:"針對行為給建議，不貼標籤，並說下一步作法。", reason:"以保護為名迴避回饋，影響成長。"},
      {text:"你只要負責可愛就好，其他都我來。", type:"over", rewrite:"切出低風險任務讓你完成，建立可靠度。", reason:"取消責任，無法鍛鍊能力。"},
    ]},
    2: {gate:{needRight:10}, hints:2, intro:"關卡2：把概念落回臨床教育情境。", items:[
      {text:"今天交班很趕，就不要讓學員講了。", type:"teacher", rewrite:"讓學員先講精要版，我補關鍵並控風險。", reason:"以時間壓力取代學習機會。"},
      {text:"我覺得他差不多了，可以放手讓他做。", type:"teacher", rewrite:"已達 3a 標準情境，半監督放手。", reason:"以主觀感覺，未對應等級與情境指標。"},
      {text:"等我有空再帶他練。", type:"teacher", rewrite:"安排短時段微演練，每天有練習與回饋。", reason:"以教師時間為中心，缺乏規律化。"},
      {text:"這次我先做示範，學員看就好。", type:"teacher", rewrite:"示範後切片段交給學員做。", reason:"示範後未轉交可委託片段。"},
      {text:"抽血技巧不熟，先用 DOPS 集中練三次。", type:"learner", rewrite:"——", reason:"分離單一技能以 DOPS 練習支撐 EPA。"},
      {text:"常遺漏交班重點，改用 ISBAR 並錄音回顧。", type:"learner", rewrite:"——", reason:"導入結構與自我回顧。"},
      {text:"他昨天兩次高風險錯誤，今天改回全程監督。", type:"learner", rewrite:"——", reason:"依風險動態調整監督強度。"},
      {text:"已在常規病人表現穩定，先讓他在標準情境半監督獨立。", type:"learner", rewrite:"——", reason:"按情境複雜度與可靠度放權。"},
      {text:"別跟他說錯在哪，怕打擊信心。", type:"over", rewrite:"聚焦行為與結果，給下一步具體作法。", reason:"迴避回饋，影響學習。"},
      {text:"他都新人，先不要讓他做任何事。", type:"over", rewrite:"切出低風險片段，在監督下練習。", reason:"剝奪練習機會，無成長責任。"},
      {text:"學員準備不足也沒關係，下次再說。", type:"over", rewrite:"界定最小安全任務與下次前的準備清單。", reason:"標準模糊，放任延宕。"},
      {text:"為了和諧，錯誤就先不提了。", type:"over", rewrite:"先私下具體回饋，再約下一次檢核。", reason:"以和諧之名忽視安全與學習。"},
    ]}
  };

  // ---- DOM ----
  const $pool = document.getElementById('poolCards');
  const $buckets = [...document.querySelectorAll('.bucket')];
  const $progress = document.getElementById('progress');
  const $result = document.getElementById('result');
  const $badlist = document.getElementById('badlist');
  const $rightCount = document.getElementById('rightCount');
  const $wrongCount = document.getElementById('wrongCount');
  const $gateText = document.getElementById('gateText');
  const $intro = document.getElementById('levelIntro');
  const $summaryArea = document.getElementById('summaryArea');
  const $gameArea = document.getElementById('gameArea');
  const $hintLeft = document.getElementById('hintLeft');

  let activeCard = null;
  let currentLevel = 1;
  let hintLeft = 2;

  // ---- Helper ----
  function shuffle(arr){ for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]} return arr }
  function showToast(msg){const $t=document.getElementById('toast'); $t.textContent=msg; $t.style.display='block'; setTimeout(()=>{$t.style.display='none'},900)}

  function renderPool(items){
    $pool.innerHTML='';
    shuffle(items).forEach((item,i)=>{
      const el=document.createElement('div');
      el.className='card';
      el.textContent=item.text;
      el.dataset.key=i;
      $pool.appendChild(el);
    });
    updateProgress(items.length);
  }
  function updateProgress(total){
    const placed= total - $pool.querySelectorAll('.card').length;
    document.getElementById('progress').textContent = `${placed} / ${total} 已分類`;
  }

  function loadLevel(lv){
    currentLevel = lv;
    const data = BANKS[lv];
    $intro.textContent = data.intro;
    hintLeft = data.hints;
    $hintLeft.textContent = hintLeft;
    $buckets.forEach(b=> b.querySelector('.cards').innerHTML='');
    renderPool(data.items);
    $result.style.display='none';
  }

  // ---- Global click delegation ----
  document.addEventListener('click', function(e){
    const t = e.target;
    // Level tabs
    if(t.classList.contains('leveltab')){
      document.querySelectorAll('.leveltab').forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      const lv = t.dataset.level;
      if(lv==='S'){ $gameArea.style.display='none'; $summaryArea.style.display='block'; buildSummary(); }
      else { $summaryArea.style.display='none'; $gameArea.style.display='block'; loadLevel(Number(lv)); }
      return;
    }
    // Buttons
    if(t.id==='btnShuffle'){ renderPool(BANKS[currentLevel].items); return; }
    if(t.id==='btnReset'){ loadLevel(currentLevel); return; }
    if(t.id==='btnCheck'){ checkAnswers(); return; }
    if(t.id==='btnHint'){ useHint(); return; }

    // Cards -> open modal
    if(t.classList.contains('card')){
      activeCard = t;
      document.getElementById('modal').style.display='flex';
      return;
    }
    // Modal choices
    if(t.classList.contains('choice')){
      const target=t.dataset.target;
      const box = document.querySelector(`.bucket[data-category="${target}"] .cards`);
      if(activeCard && box){ box.appendChild(activeCard); showToast('已放置'); updateProgress(BANKS[currentLevel].items.length); }
      document.getElementById('modal').style.display='none'; activeCard=null;
      return;
    }
    // Close modal when clicking shade
    if(t.id==='modal'){ t.style.display='none'; activeCard=null; return; }
  });

  function checkAnswers(){
    const items = BANKS[currentLevel].items;
    let correct=0; let wrong=[]; const total=items.length;
    document.querySelectorAll('.card').forEach(card=>{
      const key=Number(card.dataset.key); const answer=items[key].type;
      const parentBucket = card.closest('.bucket');
      const user = parentBucket ? parentBucket.dataset.category : 'pool';
      if(user===answer){ correct++; } else { if(user!=='pool') wrong.push({text:items[key].text, rewrite:items[key].rewrite, should:answer, reason:items[key].reason}) }
    });
    $rightCount.textContent = correct;
    $wrongCount.textContent = total - correct;
    $gateText.textContent = `至少答對 ${BANKS[currentLevel].gate.needRight} 題`;
    $badlist.innerHTML='';
    wrong.forEach(w=>{
      const div=document.createElement('div'); div.className='baditem';
      const shouldLabel = w.should==='teacher'?'教師中心': w.should==='learner'?'學員中心（責任分級）':'過度包容';
      div.innerHTML=`<div><b>應該分類：</b>${shouldLabel}</div><div style="margin-top:6px">${w.text}</div>`;
      const rw=document.createElement('div'); rw.className='rewrite'; rw.innerHTML=`<b>學員中心轉譯：</b>${w.rewrite==='——'?'（此句本身已屬學員中心，請檢查分類）':w.rewrite}<br><span style="color:#6b7280">為什麼？${w.reason}</span>`; 
      div.appendChild(rw);
      $badlist.appendChild(div);
    })
    $result.style.display='block';
  }

  function useHint(){
    if(hintLeft<=0){ showToast('提示已用完'); return; }
    if(!activeCard){ showToast('請先點選一張卡片'); return; }
    const items = BANKS[currentLevel].items;
    const key=Number(activeCard.dataset.key); const answer=items[key].type; const categories=['teacher','learner','over'];
    const wrongs = categories.filter(c=>c!==answer); const keep = wrongs[Math.floor(Math.random()*wrongs.length)];
    const options = [answer, keep].map(c=> c==='teacher'?'👩‍🏫 教師中心': c==='learner'?'🌱 學員中心（責任分級）':'💗 過度包容');
    showToast('可能是：'+options.join(' 或 '));
    setTimeout(()=>{ showToast('線索：'+items[key].reason) }, 900);
    hintLeft--; $hintLeft.textContent=hintLeft;
  }

  // Summary builder
  function buildSummary(){
    const box = document.getElementById('summaryTables');
    box.innerHTML='';
    Object.entries(BANKS).forEach(([lv, data])=>{
      const wrap=document.createElement('div'); wrap.style.margin='10px 0 20px';
      wrap.innerHTML=`<h4 style="margin:6px 0;">關卡${lv} 總表</h4>`;
      const table=document.createElement('table');
      table.innerHTML='<thead><tr><th style="width:26%">語句</th><th style="width:10%">分類</th><th style="width:30%">學員中心轉譯</th><th>理由</th></tr></thead>';
      const tbody=document.createElement('tbody');
      data.items.forEach(it=>{
        const tr=document.createElement('tr');
        const tag = it.type==='teacher' ? '<span class="tag t-teacher">教師中心</span>' :
                    it.type==='learner' ? '<span class="tag t-learner">學員中心</span>' :
                    '<span class="tag t-over">過度包容</span>';
        tr.innerHTML=`<td>${it.text}</td><td>${tag}</td><td>${it.rewrite==='——'?'—':it.rewrite}</td><td>${it.reason}</td>`;
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      wrap.appendChild(table);
      box.appendChild(wrap);
    });
  }

  // init
  loadLevel(1);
})();</script>
</body>
</html>